{% extends 'blank.html' %}
{% load static %}

{% block contenido %}
<style>
    .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 30px 20px 40px;
        padding: 20px;
        background: linear-gradient(135deg, #6b7fd7 0%, #9d8ec9 100%);
        border-radius: 20px;
        box-shadow: 0 8px 25px rgba(107, 127, 215, 0.3);
    }

    .titulo-graficas {
        font-size: 42px;
        font-weight: bold;
        color: white;
        margin: 0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        font-family: 'Garamond', serif;
    }

    .download-container {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .download-label {
        color: white;
        font-weight: 600;
        font-size: 16px;
        margin-right: 5px;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    }

    .card {
        margin: 20px;
        width: auto;
        height: 350px;
        background-image: linear-gradient(163deg, #1458b1c2 0%, #3700ff 100%);
        border-radius: 20px;
        transition: all .3s;
    }

    .card2 {
        width: auto;
        height: 350px;
        background-color: #1a1a1a;
        border-radius: 20px;
        transition: all .2s;
    }

    .card2:hover {
        transform: scale(0.995);
        border-radius: 20px;
    }

    .card:hover {
        box-shadow: 0px 0px 10px 1px rgba(3, 158, 145, 0.356);
    }

    .download-btn {
        border: 3px solid white;
        background-color: rgba(255, 255, 255, 0.95);
        width: 55px;
        height: 55px;
        border-radius: 12px;
        position: relative;
        z-index: 1;
        transition: all 0.3s ease;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .download-btn:hover {
        background-color: #1f57a0;
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .download-btn img {
        transition: all 0.3s ease;
    }

    .download-btn:hover img {
        filter: brightness(0) invert(1);
    }

    @media (max-width: 768px) {
        .header-container {
            flex-direction: column;
            gap: 20px;
        }

        .titulo-graficas {
            font-size: 32px;
            text-align: center;
        }

        .download-container {
            width: 100%;
            justify-content: center;
        }
    }
</style>

<div class="header-container">
    <h2 class="titulo-graficas">Tendencias de Solicitudes</h2>
    
    <div class="download-container">
        <audio id="audFanfare" src="{% static 'audio/fanfarrias.mp3' %}" preload="auto"></audio>
        <span class="download-label">Descargar como:</span>
        <button id="pdfBtn" class="download-btn" onclick="window.location.href='{% url 'generar_pdf_graficas' %}'" title="Descargar PDF">
            <img src="{% static 'img/download_pdf.png' %}" height="40px" width="35px" alt="PDF">
        </button>
        <button id="csvBtn" class="download-btn" onclick="window.location.href='{% url 'generar_csv_graficas' %}'" title="Descargar CSV">
            <img src="{% static 'img/download_csv2.png' %}" height="40px" width="45px" alt="CSV">
        </button>
    </div>
</div>

<div class="card" style="height: 350px; margin-bottom:40px;">
    <div class="card2" id="chart_hoy" style="height: 350px"></div>
</div>

<div class="card" style="height: 350px; margin-bottom:40px;">
    <div class="card2" id="chart_semana" style="height: 350px"></div>
</div>

<div class="card" style="height: 350px;">
    <div class="card2" id="chart_mes" style="height: 350px;"></div>
</div>

<script src="https://code.highcharts.com/highcharts.js"></script>

<script>
    // ------------------ DATA ------------------
    var data_hoy = {{ hoy|safe }};
    var data_semana = {{ semana|safe }};
    var data_mes = {{ mes|safe }};

    function generarSeries(data) {
        const colores = ['#c9a24d', '#202146', '#d7d7d7', '#c9a24d', '#202146'];
        
        return {
            categorias: data.map(item => item.tipo),
            valores: data.map((item, index) => ({
                y: item.total, 
                color: colores[index % colores.length]
            }))
        };
    }

    // HOY
    var hoySeries = generarSeries(data_hoy);
    Highcharts.chart('chart_hoy', {
        chart: { type: 'column' },
        title: { text: 'Solicitudes de Hoy'},
        xAxis: { 
            categories: hoySeries.categorias,
            title: { 
                text: 'Tipo de Solicitud',
                style: {
                    fontWeight: 'bold',
                    fontFamily: 'Garamond, "Times New Roman", serif'
                }
            },
            labels: {
                style: {
                    fontFamily: 'Garamond, "Times New Roman", serif', 
                    fontSize: '11px',                                   
                    fontWeight: 'normal'                                
                }
            },
            max: 4 
        },
        yAxis: {
            title: { text: 'Número de Solicitudes' }
        },
        legend: {
            enabled: false 
        },
        series: [{ 
            data: hoySeries.valores,
            color: '#c9a24d',
            name: 'Cantidad' 
        }]
    });
    
    // SEMANA
    var semanaSeries = generarSeries(data_semana);
    Highcharts.chart('chart_semana', {
        chart: { type: 'column' },
        title: { text: 'Solicitudes de Esta Semana' },
        xAxis: { 
            categories: semanaSeries.categorias,
            title: { 
                text: 'Tipo de Solicitud',
                style: {
                    fontWeight: 'bold',
                    fontFamily: 'Garamond, "Times New Roman", serif'
                }
            },
            labels: {
                style: {
                    fontFamily: 'Garamond, "Times New Roman", serif', 
                    fontSize: '11px',                                   
                    fontWeight: 'normal'                                
                }
            },
            max: 4
        },
        yAxis: {
            title: { text: 'Número de Solicitudes' }
        },
        legend: {
            enabled: false 
        },
        series: [{ 
            data: semanaSeries.valores,
            name: 'Cantidad', 
        }]
    });

    // MES
    var mesSeries = generarSeries(data_mes);
    Highcharts.chart('chart_mes', {
        chart: { type: 'column' },
        title: { text: 'Solicitudes de Este Mes' },
        xAxis: { 
            categories: mesSeries.categorias,
            title: { 
                text: 'Tipo de Solicitud',
                style: {
                    fontWeight: 'bold',
                    fontFamily: 'Garamond, "Times New Roman", serif'
                }
            },
            labels: {
                style: {
                    fontFamily: 'Garamond, "Times New Roman", serif', 
                    fontSize: '11px',                                   
                    fontWeight: 'normal'                                
                }
            },
            max: 4 
        },
        yAxis: {
            title: { 
                text: 'Número de Solicitudes',
                style: {
                    fontWeight: 'bold',
                    fontFamily: 'Garamond, "Times New Roman", serif'
                }
            }
        },
        legend: {
            enabled: false 
        },
        series: [{ 
            data: mesSeries.valores,
            color: '#F23863',
            name: 'Cantidad'
        }]
    });
</script>

<script>
    // Reproducir sonido al hacer clic en los botones de descarga
    document.getElementById('pdfBtn').addEventListener('click', function() {
        document.getElementById('audFanfare').play();
    });

    document.getElementById('csvBtn').addEventListener('click', function() {
        document.getElementById('audFanfare').play();
    });
</script>

{% endblock contenido %}